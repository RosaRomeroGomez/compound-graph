"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("lodash"),t=require("d3");function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=n(e);function a(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){a(i,r,o,s,l,"next",e)}function l(e){a(i,r,o,s,l,"throw",e)}s(void 0)}))}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var a=h(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return p(this,n)}}function y(e,t,n){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function v(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k={createChart:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.attr("width",t+"px"),e.attr("height",n+"px");var a=r.x1||0,o=r.y1||0,i=r.x2||t,s=r.y2||n;return e.attr("preserveAspectRatio","xMinYMin meet"),e.attr("viewBox","".concat(a," ").concat(o," ").concat(i," ").concat(s)),e.append("defs"),e},translate:function(e,t){return"translate(".concat(e,", ").concat(t,")")},line:function(e,t,n,r){return"M"+e+","+t+"L"+n+","+r},pathFn:t.line().x((function(e){return e.x})).y((function(e){return e.y})),MARKER_VIEWBOX:"-5 -5 10 10",ARROW:"M 0,-3.25 L 5 ,0 L 0,3.25",ARROW_SHARP:"M 0,-3 L 5 ,0 L 0,3 L 1 0"},x=["backgroundClick","backgroundDblClick","backgroundMouseEnter","backgroundMouseLeave","backgroundCtx","nodeClick","nodeDblClick","nodeMouseEnter","nodeMouseLeave","nodeCtx","nodeSave","edgeClick","edgeMouseEnter","edgeMouseLeave","edgeCtx"],b=function(){function e(){i(this,e),this.data={},this.registry={}}return l(e,[{key:"setData",value:function(e){this.data=e}},{key:"setCallback",value:function(e,t){if(-1===x.indexOf(e))throw new Error("Failed to register callback, unknown name ".concat(e));this.registry[e]=t}},{key:"unsetCallback",value:function(e){delete this.registry[e]}},{key:"initialize",value:function(e){throw new Error("Needs impl")}},{key:"render",value:function(){throw new Error("Needs impl")}}]),e}(),w=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n(t,r),t.nodes)for(var a=r+1,o=0;o<t.nodes.length;o++)e(t.nodes[o],n,a)},E=function(e){var t=[],n=[];return w(e,(function(e,r){r>0&&(t=t.concat(e)),e.edges&&(n=n.concat(e.edges))})),{nodes:t,edges:n}},A=k.pathFn.curve(t.curveBasis),O=function(e,t){return{x1:e.x1,y1:e.y1,x2:Math.max(e.x2,t.width),y2:Math.max(e.y2,t.height)}},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(M,b);var n,a,s,c,u,p,m,x,C=g(M);function M(e){var t;if(i(this,M),(t=C.call(this)).options=e||{},t.options.renderMode=t.options.renderMode||"basic",t.options.useEdgeControl=t.options.useEdgeControl||!1,t.options.edgeControlOffsetType=t.options.edgeControlOffsetType||"percentage",t.options.edgeControlOffset=t.options.edgeControlOffset||.66,t.options.useDebugger=t.options.useDebugger||!1,t.adapter=t.options.adapter,t.parentEl=null,t.svgEl=null,t.chart=null,t.chartSize={width:1,height:1},t.layout=null,!e.el)throw new Error("options must provide an element for graph rendering");return t.initialize(e.el),t.zoom=null,t.collapseTracker={},t.hiddenEdges={},t}return l(M,[{key:"initialize",value:function(e){this.parentEl=e,this.chartSize.width=this.parentEl.clientWidth,this.chartSize.height=this.parentEl.clientHeight,this.svgEl=document.createElementNS("http://www.w3.org/2000/svg","svg"),function(e){for(;e.firstChild;)e.removeChild(e.firstChild);return e}(this.parentEl).appendChild(this.svgEl),this.svgEl.style.userSelect="none"}},{key:"setData",value:function(e){y(h(M.prototype),"setData",this).call(this,e),this.layout=null}},{key:"render",value:(x=o(regeneratorRuntime.mark((function e(){var n,r,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.options,this.layout){e.next=5;break}return e.next=4,this.runLayout();case 4:this.layout=e.sent;case 5:this.chart?(r=this.layout.width,a=this.layout.height,o=O({x1:0,y1:0,x2:r,y2:a},this.chartSize),t.select(this.svgEl).attr("viewBox","".concat(o.x1," ").concat(o.y1," ").concat(o.x2," ").concat(o.y2)),t.select(this.svgEl).transition().call(this.zoom.transform,t.zoomIdentity),i=Math.max(2,Math.floor(this.layout.width/this.chartSize.width)),this.zoom.scaleExtent([.5,i])):this.chart=this._createChart(),this.buildDefs(),"basic"===n.renderMode?(this.renderNodes(),this.renderEdges()):(this.renderNodesDelta(),this.renderEdgesDelta()),n.useEdgeControl&&this.renderEdgeControls(),this._enableDrag(),n.useDebugger&&this.renderDebug(),this._enableInteraction();case 12:case"end":return e.stop()}}),e,this)}))),function(){return x.apply(this,arguments)})},{key:"buildDefs",value:function(){var e=t.select(this.svgEl),n=E(this.layout).edges;e.select("defs").selectAll(".edge-marker-end").remove(),e.select("defs").selectAll(".edge-marker-end").data(n).enter().append("marker").classed("edge-marker-end",!0).attr("id",(function(e){var t=e.data.source.replace(/\s/g,""),n=e.data.target.replace(/\s/g,"");return"arrowhead-".concat(t,"-").concat(n)})).attr("viewBox",k.MARKER_VIEWBOX).attr("refX",2).attr("refY",0).attr("orient","auto").attr("markerWidth",15).attr("markerHeight",15).attr("markerUnits","userSpaceOnUse").attr("xoverflow","visible").append("svg:path").attr("d",k.ARROW).style("fill","#000").style("stroke","none")}},{key:"renderEdgesDelta",value:function(){var e=this.chart,n=[];w(this.layout,(function(e){e.edges&&e.edges.length>0&&(n=n.concat(e.edges))}));var r=e.selectAll(".edge").data(n,(function(e){return e.id})),a=r.enter().append("g").classed("edge",!0);r.exit().each((function(e){return e.state="removed"})),a.each((function(e){return e.state="new"})),r.each((function(e){return e.state="updated"})),e.selectAll(".edge").filter((function(e){return"updated"===e.state})).each((function(e){t.select(this).selectAll(".edge-path").datum(e)})),e.selectAll(".edge").filter((function(e){return"new"===e.state})).call(this.renderEdgeAdded),e.selectAll(".edge").filter((function(e){return"updated"===e.state})).call(this.renderEdgeUpdated),e.selectAll(".edge").filter((function(e){return"removed"===e.state})).call(this.renderEdgeRemoved)}},{key:"renderEdges",value:function(){var e=this.chart;e.selectAll(".edge").remove();!function t(n){n.nodes&&n.nodes.forEach((function(e){t(e)})),n.edges&&e.selectAll(".edge").data(n.edges,(function(e){return e.id})).enter().append("g").classed("edge",!0)}(this.layout),e.selectAll(".edge").call(this.renderEdge)}},{key:"renderNodesDelta",value:function(){var e=this.chart;!function e(n,r){if(r){var a=n.selectAll(".node").filter((function(){return this.parentNode===n.node()})).data(r,(function(e){return e.id})),o=a.enter().append("g").classed("node",!0);a.exit().each((function(e){return e.state="removed"})),o.each((function(e){return e.state="new"})),a.each((function(e){return e.state="updated"})),[o,a].forEach((function(n){n.each((function(n){var r=t.select(this);0===r.select(".node-ui").size()&&r.append("g").classed("node-ui",!0),r.select(".node-ui").datum(n),0===r.select(".node-children").size()&&r.append("g").classed("node-children",!0),e(r.select(".node-children"),n.nodes)})),n.transition().duration(1e3).attr("transform",(function(e){return k.translate(e.x,e.y)}))}))}}(e,this.layout.nodes),e.selectAll(".node-ui").filter((function(e){return"new"===e.state})).call(this.renderNodeAdded),e.selectAll(".node-ui").filter((function(e){return"updated"===e.state})).call(this.renderNodeUpdated),e.selectAll(".node-ui").filter((function(e){return"removed"===e.state})).call(this.renderNodeRemoved)}},{key:"renderNodes",value:function(){var e=this.chart;e.selectAll(".node").remove();!function e(n,r){r&&n.selectAll(".node").data(r).enter().append("g").classed("node",!0).attr("transform",(function(e){return k.translate(e.x,e.y)})).each((function(n){var r=t.select(this);r.append("g").classed("node-ui",!0),e(r.append("g"),n.nodes)}))}(e,this.layout.nodes),e.selectAll(".node-ui").call(this.renderNode)}},{key:"calculateEdgeControlPlacement",value:function(e){var t=this.options,n=0,r=e.getTotalLength(),a=t.edgeControlOffset;return n="percentage"===t.edgeControlOffsetType?a*r:a>0?a:Math.max(0,r+a),e.getPointAtLength(n)}},{key:"renderEdgeControls",value:function(){var e=this.chart,n=e.selectAll(".edge");n.selectAll(".edge-control").remove();var r=this;n.each((function(){var e=t.select(this).select("path").node(),n=r.calculateEdgeControlPlacement(e);t.select(this).append("g").classed("edge-control",!0).attr("transform",k.translate(n.x,n.y))})),e.selectAll(".edge-control").call(this.renderEdgeControl)}},{key:"renderDebug",value:function(){var e=this.chart,n=this.options,r=this.chartSize,a=t.select(this.svgEl).select(".background-layer"),o=.5*(this.layout.width<r.width?r.width:this.layout.width),i=.5*(this.layout.height<r.height?r.height:this.layout.height),s=[[-5e3,i,5e3,i],[o,-5e3,o,5e3]];a.selectAll(".info").remove();var l=a.append("g").classed("info",!0),c=t.zoomTransform(e.node());l.append("text").text("TS: "+c.k.toFixed(2)),l.append("text").text("TX: "+c.x.toFixed(2)),l.append("text").text("TY: "+c.y.toFixed(2)),l.append("text").text("Mode: "+n.renderMode),l.selectAll("text").attr("x",3).attr("y",(function(e,t){return 14*(t+1)})).style("font-size","10px"),a.selectAll(".grid").remove(),a.selectAll(".grid").data(s).enter().append("path").classed("grid",!0).attr("d",(function(e){return k.line.apply(k,v(e))})).style("fill","none").style("stroke","#00F").style("stroke-width",1.5).style("opacity",.5)}},{key:"runLayout",value:(m=o(regeneratorRuntime.mark((function e(){var t,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.adapter.makeRenderingGraph(this.data),n=this.adapter.run(t),e.abrupt("return",n);case 3:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"highlight",value:function(e,n){var a=e.nodes,o=e.edges,i=t.select(this.svgEl),s=this.chart,l=n.color||"red",c=n.duration||2e3,u="glow".concat((new Date).getTime()),d=i.select("defs").append("filter").attr("id",u).attr("width","200%").attr("filterUnits","userSpaceOnUse");d.append("feGaussianBlur").attr("stdDeviation",4.5).attr("result","blur"),d.append("feOffset").attr("in","blur").attr("result","offsetBlur").attr("dx",0).attr("dy",0).attr("x",-10).attr("y",-10),d.append("feFlood").attr("in","offsetBlur").attr("flood-color",l).attr("flood-opacity",.95).attr("result","offsetColor"),d.append("feComposite").attr("in","offsetColor").attr("in2","offsetBlur").attr("operator","in").attr("result","offsetBlur");var h=d.append("feMerge");h.append("feMergeNode").attr("in","offsetBlur"),h.append("feMergeNode").attr("in","SourceGraphic");var f=s.selectAll(".node").filter((function(e){return a.includes(e.id)}));f.style("filter","url(#".concat(u,")")).classed("".concat(u),!0);var p=s.selectAll(".edge").filter((function(e){return r.default.some(o,(function(t){return t.source===e.data.source&&t.target===e.data.target}))}));return p.style("filter","url(#".concat(u,")")).classed("".concat(u),!0),i.select("#".concat(u)).select("feGaussianBlur").transition().duration(c).attr("stdDeviation",0).on("end",(function(){f.style("filter",null),p.style("filter",null)})),u}},{key:"unHighlight",value:function(e){var n=t.select(this.svgEl);n.select("#".concat(e)).remove(),n.selectAll(".".concat(e)).style("filter",null)}},{key:"moveTo",value:function(e,n){var a=this.chart,o=this.chartSize,i=t.select(this.svgEl),s=this.layout.width<o.width?o.width:this.layout.width,l=this.layout.height<o.height?o.height:this.layout.height,c=t.zoomTransform(a.node()),u=E(this.layout).nodes.find((function(t){return t.id===e}));if(!r.default.isNil(u)){for(var d=u.x,h=u.y,f=u;f.parent&&0!==f.parent.depth;)d+=(f=f.parent).x,h+=f.y,console.log(d,h);var p=d+.5*u.width,g=h+.5*u.height;i.transition().duration(n).call(this.zoom.transform,t.zoomIdentity.translate(0,0).scale(c.k).translate(-p+.5*s/c.k,-g+.5*l/c.k))}}},{key:"collapse",value:(p=o(regeneratorRuntime.mark((function e(t){var n,a,o,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.chart.selectAll(".node").filter((function(e){return e.id===t})),a=n.selectAll(".node").data().map((function(e){return e.id})),o=this.collapseTracker,i=this.hiddenEdges,o[t]={},o[t].edgeMap={},0!==a.length){e.next=8;break}return e.abrupt("return");case 8:return w(this.layout,(function(e){if(e.id===t&&(e.width=40,e.height=40,o[t].nodes=e.nodes,e.nodes=[],e.collapsed=!0),e.edges){var n=r.default.remove(e.edges,(function(e){return a.includes(e.source)&&a.includes(e.target)}));r.default.isEmpty(n)||(i[e.id]=n);for(var s=0;s<e.edges.length;s++){var l=e.edges[s],c=l.source,u=l.target,d={};a.includes(c)&&(d.source=l.source,l.source=t),a.includes(u)&&(d.target=l.target,l.target=t),r.default.isEmpty(d)||(o[t].edgeMap[l.id]=d)}}})),e.next=11,this.adapter.run(this.layout);case 11:this.layout=e.sent,this.render();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"expand",value:(u=o(regeneratorRuntime.mark((function e(t){var n,r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.chart.selectAll(".node").filter((function(e){return e.id===t})),r=this.collapseTracker,a=this.hiddenEdges,o=r[t],n.datum().nodes=o.nodes,n.datum().collapsed=!1,w(n.datum(),(function(e){({}).hasOwnProperty.call(a,e.id)&&!1===e.collapsed&&(e.edges=e.edges.concat(a[e.id]),delete a[e.id])})),w(this.layout,(function(e){if(e.edges)for(var t=0;t<e.edges.length;t++){var n=e.edges[t];o.edgeMap[n.id]&&(n.target=o.edgeMap[n.id].target||n.target,n.source=o.edgeMap[n.id].source||n.source)}})),delete r[t],e.next=11,this.adapter.run(this.layout);case 11:this.layout=e.sent,this.render();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"focus",value:(c=o(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1===(n=this.chart.selectAll(".node").filter((function(e){return!0===e.focused}))).size()&&(delete(r=n.datum()).width,delete r.height,delete r.focused),!((a=this.chart.selectAll(".node").filter((function(e){return e.id===t}))).nodes&&a.nodes.length>0)){e.next=5;break}return e.abrupt("return");case 5:return a.datum().width=400,a.datum().height=300,a.datum().focused=!0,e.next=10,this.adapter.run(this.layout);case 10:this.layout=e.sent,this.render();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"unfocus",value:(s=o(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.chart.selectAll(".node").filter((function(e){return e.id===t})),delete(r=n.datum()).width,delete r.height,delete r.focused,e.next=7,this.adapter.run(this.layout);case 7:this.layout=e.sent,this.render();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"group",value:(a=o(regeneratorRuntime.mark((function e(t,n){var a,o,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.chart,o=a.selectAll(".node").filter((function(e){return n.includes(e.id)})).data(),1===r.default.uniq(o.map((function(e){return e.parent.id}))).length){e.next=5;break}return console.log("Cannot group across different levels"),e.abrupt("return");case 5:return i={id:t,label:t,concept:t,depth:o[0].depth,type:"custom",parent:o[0].parent,nodes:[],data:{label:t}},s=o[0].parent,n.forEach((function(e){var t=d({},r.default.remove(s.nodes,(function(t){return t.id===e}))[0]);t.parent=i,i.nodes.push(t)})),s.nodes.push(i),e.next=11,this.adapter.run(this.layout);case 11:this.layout=e.sent,this.render();case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"ungroup",value:(n=o(regeneratorRuntime.mark((function e(t){var n,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.chart,a=n.selectAll(".node").filter((function(e){return e.id===t})).data()[0],o=a.parent,r.default.remove(o.nodes,(function(e){return e.id===t})),a.nodes.forEach((function(e){var t=d({},e);t.parent=o,o.nodes.push(t)})),delete a.nodes,e.next=8,this.adapter.run(this.layout);case 8:this.layout=e.sent,this.render();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"boundary",value:function(){var e=this.chart,n=t.zoomTransform(e.node());return{x1:(0-n.x)/n.k,y1:(0-n.y)/n.k,x2:(this.layout.width-n.x)/n.k,y2:(this.layout.height-n.y)/n.k}}},{key:"cullEdges",value:function(){var e=this.boundary(),n=e.x1,a=e.y1,o=e.x2,i=e.y2;this.chart.selectAll(".edge").each((function(e){var s=r.default.first(e.points),l=r.default.last(e.points);(s.x<n||s.x>o||s.y<a||s.y>i)&&(l.x<n||l.x>o||l.y<a||l.y>i)&&t.select(this).style("opacity",0)}))}},{key:"uncullEdges",value:function(){t.selectAll(".edge").style("opacity",1)}},{key:"_createChart",value:function(){var e=this.chartSize,n=e.width,r=e.height,a={x1:0,y1:0,x2:this.layout.width,y2:this.layout.height},o=t.select(this.svgEl);o.selectAll("*").remove();var i=k.createChart(o,n,r,O(a,this.chartSize));i.attr("preserveAspectRatio","xMidYMid meet"),i.append("g").classed("background-layer",!0);var s=i.append("g").classed("data-layer",!0);i.append("g").classed("foreground-layer",!0);var l=this;var c=Math.max(2,Math.floor(this.layout.width/this.chartSize.width));return this.zoom=t.zoom().scaleExtent([.5,c]).on("zoom",(function(){s.attr("transform",t.event.transform),l.options.useDebugger&&l.renderDebug()})),o.call(this.zoom).on("dblclick.zoom",null),s}},{key:"_enableInteraction",value:function(){var e=this.chart,n=this,r=this.registry,a=t.select(this.svgEl),o=e.selectAll(".node"),i=e.selectAll(".edge");n.clickTimer=null;var s=function(e){return{}.hasOwnProperty.call(r,e)};a.on("click",(function(){t.event.stopPropagation();var e=t.zoomTransform(a.node()).invert(t.mouse(this));s("backgroundClick")&&r.backgroundClick(t.select(this),n,{x:e[0],y:e[1]})})),a.on("dblclick",(function(){t.event.stopPropagation();var e=t.zoomTransform(a.node()).invert(t.mouse(this));s("backgroundDblClick")&&r.backgroundDblClick(t.select(this),n,{x:e[0],y:e[1]})})),o.on("dblclick",(function(){t.event.stopPropagation(),s("nodeDblClick")&&(window.clearTimeout(n.clickTimer),r.nodeDblClick(t.select(this),n))})),o.on("click",(function(){if(t.event.stopPropagation(),s("nodeClick")){var e=this;window.clearTimeout(n.clickTimer),n.clickTimer=window.setTimeout((function(){r.nodeClick(t.select(e),n)}),200)}})),o.on("mouseenter",(function(){t.event.stopPropagation(),s("nodeMouseEnter")&&r.nodeMouseEnter(t.select(this),n)})),o.on("mouseleave",(function(){t.event.stopPropagation(),s("nodeMouseLeave")&&r.nodeMouseLeave(t.select(this),n)})),i.on("click",(function(){t.event.stopPropagation(),s("edgeClick")&&r.edgeClick(t.select(this),n)})),i.on("mouseenter",(function(){t.event.stopPropagation(),s("edgeMouseEnter")&&r.edgeMouseEnter(t.select(this),n)})),i.on("mouseleave",(function(){t.event.stopPropagation(),s("edgeMouseLeave")&&r.edgeMouseLeave(t.select(this),n)}))}},{key:"_enableDrag",value:function(){var e=this.chart,n=this.options,r=E(this.layout),a=e.selectAll(".node"),o=this;var i=t.drag().on("start",(function(){t.event.sourceEvent.stopPropagation()})).on("end",(function(){})).on("drag",(function(){var a=t.select(this),i=[a.datum().id].concat(v(a.selectAll(".node").data().map((function(e){return e.id})))),s=t.select(this.parentNode).datum(),l=t.event.dx,c=t.event.dy;if(s){if(a.datum().x+a.datum().width+l>s.width||a.datum().x+l<0)return;if(a.datum().y+a.datum().height+c>s.height||a.datum().y+c<0)return}a.datum().x+=l,a.datum().y+=c,a.attr("transform",k.translate(a.datum().x,a.datum().y)),r.edges.forEach((function(e){var t=e.source,n=e.target;i.includes(t)&&i.includes(n)?e.points.forEach((function(e){e.x+=l,e.y+=c})):i.includes(t)?(e.points[0].x+=l,e.points[0].y+=c):i.includes(n)&&(e.points[e.points.length-1].x+=l,e.points[e.points.length-1].y+=c)})),e.selectAll(".edge").selectAll("path").attr("d",(function(e){return A(e.points)})),n.useEdgeControl&&e.selectAll(".edge").each((function(){var e=t.select(this).select("path").node(),n=o.calculateEdgeControlPlacement(e);t.select(this).select(".edge-control").attr("transform",k.translate(n.x,n.y))}))}));a.call(i)}},{key:"_trace",value:function(e){var t={},n=this.layout||{edges:[]},a=[];return function e(r){({}).hasOwnProperty.call(t,r)||(t[r]=1,n.edges.filter((function(e){return e.data.target===r})).forEach((function(t){a.push(t),e(t.data.source)})))}(e),{edges:a.map((function(e){return{source:e.data.source,target:e.data.target}})),nodes:r.default.uniq([].concat(v(a.map((function(e){return e.data.source}))),v(a.map((function(e){return e.data.target})))))}}}]),M}();exports.SVGRenderer=C;
//# sourceMappingURL=main.js.map
